<img width="400px" src="https://velog.velcdn.com/images/soopy368/post/426525a0-26ee-4dce-bae8-61df6209f9d4/image.png" />
## 클로저란 무엇인가?

### 💡 정확한 정의

클로저란, 내부 함수가 정의될 때 외부 함수의 환경을 기억하고 있는 내부 함수이다.

### 😇 쉽게 이해하기

클로저란, 자신이 선언될 당시의 환경을 기억하는 함수이다.

<br />

## 어떻게 동작하나요?

### 선행 지식

- **스코프**
  - 변수에 접근할 수 있는 범위, JS에는 전역 스코프와 지역 스코프 타입이 있다.
- **렉시컬 스코프**
  - 함수를 어디에 `선언`하였는지에 따라 `상위 스코프가 결정`된다. 이를 정적 스코프라고 부르기도 한다.
  ```jsx
  var x = 1;

  function foo() {
    var x = 10;
    bar();
  }

  function bar() {
    console.log(x);
  }

  foo(); // 1
  bar(); // 1
  ```
  1. bar()에서 참조하는 x 변수는 bar()의 상위 스코프가 무엇인지에 따라 결정된다.
  2. bar()는 전역에 선언되었으므로, 상위 스코프는 전역 스코프가 된다.
  3. 따라서 bar()의 x는 전역에 선언된 x 변수를 참조하게 된다.

<br />

### 동작 원리

- 클로저는 자신이 생성될 때의 환경(=렉시컬 스코프)을 기억하는 함수이다.
- 자바스크립트의 모든 함수는 [[Environment]]라 불리는 숨김 프로퍼티를 갖는다. 이곳에 함수가 만들어진 곳의 렉시컬 스코프에 대한 참조가 저장된다.
- 함수 본문에서 [[Environment]]를 사용해서 외부 변수에 접근할 수 있게 된다.

### 😇 쉽게 이해하기

- 클로저 = 함수 + 렉시컬 스코프
- JS의 모든 함수는 자신이 생성된 환경의 주소를 저장하고 있다.
- 함수 본문에서 자신이 생성된 환경을 참조하여 외부 변수에 접근할 수 있게 된다.

### 코드로 이해해봐요

```jsx
const outer = () => {
  let x = 10; // '자유 변수' 라고 한다.

  // 클로저
  const inner = (y) => {
    x = x + y;
    console.log(x);
  };

  return inner;
};

const addFunc = outer();
addFunc(5); // 15
addFunc(10); // 25
```

- `inner의 x`는 렉시컬 스코프에 의해 `outer의 지역변수 x`를 참조하고 있다.
- 그리고 outer는 `const addFunc = outer();`구문에서 호출된 후 콜스택에서 제거된다.
- 하지만 `내부 함수가 유효`한 상태에서는 외부 함수가 종료되어도 [[Environment]]에서 `렉시컬 스코프를 참조`하고 있기 때문에 외부 함수의 x 변수를 참조할 수 있다.
- 여기서 내부 함수를 `클로저`라고 한다.

## 왜 사용하는 걸까요?

1. 상태 유지: 현재 상태를 기억하고 변경된 최신 상태를 유지할 수 있다.
2. 정보 은닉: 변수 값을 은닉할 수 있다. 클래스 기반 언어의 private 키워드를 흉내낼 수 있다.
3. 전역 변수 사용 억제: 전역 변수를 대체하여 오류를 피하는 안정성을 증가시킬 수 있다.

## 추가 설명

- 클로저는 Javascript만의 고유 개념은 아니고, 함수를 일급 객체로 취급하는 함수형 프로그래밍 언어에서 사용되는 특징 중 하나입니다.
- 렉시컬 스코프란 선언된 위치에 따라 상위 스코프가 결정되는 정적 스코프이다.
- 이와 반대로 `동적 스코프`는 함수를 `호출한 위치`에 따라 상위 스코프가 결정된다. 다만, 대부분의 프로그래밍 언어는 모두 정적 스코프를 따른다.
